<?xml version="1.0" encoding="UTF-8"?>
<cpp:cpp xmlns:cpp="https://eden-fidelis.eu/cpp/cpp/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.w3.org/1999/xhtml"
    xsi:schemaLocation="https://eden-fidelis.eu/cpp/cpp/ ../cpp.xsd"
    ID="CPP-001" xml:lang="en">
    <cpp:header>
        <cpp:label>Checksum Generation and Recording</cpp:label>
        <cpp:authors>
            <cpp:author>Kris Dekeyser</cpp:author>
        </cpp:authors>
        <cpp:contributors>
            <cpp:contributor>Johan Kylander</cpp:contributor>
            <cpp:contributor>Bertrand Caron</cpp:contributor>
        </cpp:contributors>
        <cpp:evaluators>
            <cpp:evaluator>Felix Burger</cpp:evaluator>
            <cpp:evaluator>Maria Benauer</cpp:evaluator>
            <cpp:evaluator>Fen Zhang</cpp:evaluator>
        </cpp:evaluators>
        <cpp:history>
            <cpp:version>
                <cpp:versionNumber>
                    <cpp:majorVersion>1</cpp:majorVersion>
                    <cpp:minorVersion>1</cpp:minorVersion>
                    <cpp:patchVersion>0</cpp:patchVersion>
                </cpp:versionNumber>
                <cpp:versionDate>2025-08-29</cpp:versionDate>
                <cpp:versionNotes>Milestone version</cpp:versionNotes>
            </cpp:version>
        </cpp:history>
    </cpp:header>
    <cpp:shortDefinition>The TDA (Trustworthy Digital Archive) records checksums for every File.</cpp:shortDefinition>
    <cpp:descriptionAndScope>
        <p>A checksum or message digest is a fixed size stream of data generated by a
            transformation of the <em>File</em> data by means of an algorithm. Any
            change to the data would result in a change to the calculated digest. The algorithm can
            be a cyclic redundancy check or a cryptographic hash function.</p>
        <p>The <em>File</em> checksums form an important part of the fixity
            information which is the cornerstone for performing bit-level digital preservation. The
            system must keep track of this message digest for each <em>File</em>. Due to
            the possibility of collisions (multiple data streams having the same checksum), storing
            multiple message digests generated by different algorithms is recommended. The TDA
            policy should define a list of required algorithms.</p>
        <p>The Checksum Generation and Recording process is the action of acquiring and
            storing the message digests associated with any <em>File</em> that the
            system needs to keep track of. Files should come with any number of checksums generated
            prior to their submission. In that case, the system should store those checksums and use
            them as-is and new checksums should be generated for those algorithms that are missing.</p>
    </cpp:descriptionAndScope>
    <cpp:process>
        <cpp:inputs>
            <cpp:data>
                <cpp:dataElement>File</cpp:dataElement>
            </cpp:data>
            <cpp:guidance>
                <cpp:guidanceElement>Storage management policy - Checksum algorithms</cpp:guidanceElement>
            </cpp:guidance>
        </cpp:inputs>
        <cpp:outputs>
            <cpp:metadata>
                <cpp:metadataElement>Fixity metadata (one or multiple checksum(s) for the File as well
                    as their associated algorithms)</cpp:metadataElement>
                <cpp:metadataElement>Provenance metadata (a timestamp or event that describes the
                    checksum calculation)</cpp:metadataElement>
            </cpp:metadata>
        </cpp:outputs>
        <cpp:triggerEvents>
            <cpp:triggerEvent>
                <cpp:description>
                    <p>A new <em>SIP</em> is submitted and processed</p>
                </cpp:description>
                <cpp:correspondingCPP>CPP-029</cpp:correspondingCPP>
            </cpp:triggerEvent>
            <cpp:triggerEvent>
                <cpp:description>
                    <p><em>File</em> update or replacement due to Preservation
                        Action (e.g. migration)</p>
                </cpp:description>
                <cpp:correspondingCPP>CPP-014</cpp:correspondingCPP>
            </cpp:triggerEvent>
            <cpp:triggerEvent>
                <cpp:description>
                    <p>Any other action that results in a new or updated <em>File</em>
                        being added to the system</p>
                </cpp:description>
            </cpp:triggerEvent>
        </cpp:triggerEvents>
        <cpp:stepByStepDescription>
            <cpp:step stepNumber="1">
                <cpp:input>
                    <cpp:inputElement>
                        <p>Storage management policy - Checksum algorithms</p>
                    </cpp:inputElement>
                </cpp:input>
                <cpp:stepDescription>
                    <p>Get the list of accepted checksum algorithms</p>
                </cpp:stepDescription>
                <cpp:output>
                    <cpp:outputElement>
                        <p>List of accepted checksum algorithms</p>
                    </cpp:outputElement>
                </cpp:output>
            </cpp:step>
            <cpp:step stepNumber="2">
                <cpp:input>
                    <cpp:inputElement>
                        <p>
                            <em>File</em>
                        </p>
                    </cpp:inputElement>
                </cpp:input>
                <cpp:input>
                    <cpp:inputElement>
                        <p>
                            <em>List of checksum algorithms</em>
                        </p>
                    </cpp:inputElement>
                </cpp:input>
                <cpp:stepDescription>
                    <p>Calculate the checksum for each algorithm</p>
                </cpp:stepDescription>
                <cpp:output>
                    <cpp:outputElement>
                        <p>List of checksums for the <em>File</em> based on
                            different algorithms</p>
                    </cpp:outputElement>
                </cpp:output>
            </cpp:step>
            <cpp:step stepNumber="3">
                <cpp:input>
                    <cpp:inputElement>
                        <p>List of checksums for the <em>File</em> based on
                            different algorithms</p>
                    </cpp:inputElement>
                </cpp:input>
                <cpp:stepDescription>
                    <p>Store the checksums in the <em>Fixity metadata</em> for the <em>
                        File</em></p>
                </cpp:stepDescription>
                <cpp:output>
                    <cpp:outputElement>
                        <p>Updated <em>Fixity metadata</em> of the <em>
                                File</em> in the TDA database</p>
                    </cpp:outputElement>
                    <cpp:customer>CPP-002</cpp:customer>
                    <cpp:customer>CPP-003</cpp:customer>
                </cpp:output>
            </cpp:step>
            <cpp:step stepNumber="4">
                <cpp:input>
                    <cpp:inputElement>
                        <p>
                            <em>File</em>
                        </p>
                    </cpp:inputElement>
                </cpp:input>
                <cpp:stepDescription>
                    <p>Document the event and its datetime</p>
                </cpp:stepDescription>
                <cpp:output>
                    <cpp:outputElement>
                        <p>Datetime for the checksum generation and other related <em>Provenance
                            metadata</em></p>
                    </cpp:outputElement>
                </cpp:output>
            </cpp:step>
        </cpp:stepByStepDescription>
    </cpp:process>
    <cpp:rationaleWorstCase>
        <cpp:purpose>
            <cpp:purposeDescription>
                <p>Keeping track of the fixity information of each <em>File</em></p>
            </cpp:purposeDescription>
            <cpp:worstCase>
                <p>Corrupted data can get undetected or be detected when it is too
                    late to take corrective action</p>
            </cpp:worstCase>
        </cpp:purpose>
        <cpp:purpose>
            <cpp:purposeDescription>
                <p>Event datetime for checksum generation</p>
            </cpp:purposeDescription>
            <cpp:worstCase>
                <p>No starting point from when the fixity can be checked (and
                    guaranteed)</p>
            </cpp:worstCase>
        </cpp:purpose>
        <cpp:purpose>
            <cpp:purposeDescription>
                <p>Multiple checksums for each <em>File</em></p>
            </cpp:purposeDescription>
            <cpp:worstCase>
                <p>Collisions where changes to a <em>File</em> produce the same
                    checksum, are more likely with a single checksum algorithm than with multiple
                    checksum algorithms</p>
            </cpp:worstCase>
        </cpp:purpose>
    </cpp:rationaleWorstCase>
    <cpp:cppRelationships>
        <cpp:relationship>
            <cpp:relationshipType>Required by</cpp:relationshipType>
            <cpp:relatedCPP>CPP-002</cpp:relatedCPP>
            <cpp:relationshipDescription>
                <p>CPP-002 relies on fixity information as produced and stored by CPP-001,
                    when triggered by CPP-025 Enabling Access and CPP-006 AIP Batch Export. When
                    triggered by CPP-029 Ingest CPP-002 rather relies on the fixity information
                    supplied in the SIP.</p>
            </cpp:relationshipDescription>
        </cpp:relationship>
        <cpp:relationship>
            <cpp:relationshipType>Required by</cpp:relationshipType>
            <cpp:relatedCPP>CPP-003</cpp:relatedCPP>
            <cpp:relationshipDescription>
                <p>The integrity checking process relies on the fixity information as produced
                    and stored by CPP-001.</p>
            </cpp:relationshipDescription>
        </cpp:relationship>
        <cpp:relationship>
            <cpp:relationshipType>Required by</cpp:relationshipType>
            <cpp:relatedCPP>CPP-006</cpp:relatedCPP>
            <cpp:relationshipDescription>
                <p><em>Fixity metadata</em> is used to verify the integrity of
                    data written into the exported AIP.</p>
            </cpp:relationshipDescription>
        </cpp:relationship>
        <cpp:relationship>
            <cpp:relationshipType>Required by</cpp:relationshipType>
            <cpp:relatedCPP>CPP-016</cpp:relatedCPP>
            <cpp:relationshipDescription>
                <p>The checksums and associated algorithms need to be stored in the <em>
                    File</em>’s <em>Fixity metadata</em> is used to verify the
                    integrity of data written into the exported AIP.</p>
            </cpp:relationshipDescription>
        </cpp:relationship>
    </cpp:cppRelationships>
    <cpp:frameworkMappings>
        <cpp:mapping>
            <cpp:frameworkName>CoreTrustSeal</cpp:frameworkName>
            <cpp:correspondingTerm>
                <p>Checksum (cf <a href="https://doi.org/10.5281/zenodo.7051096">Extended
                    Guidance documentation</a>)</p>
            </cpp:correspondingTerm>
            <cpp:correspondingSection>
                <p>Information Technology &amp; Security/Storage &amp; Integrity (R14)</p>
            </cpp:correspondingSection>
        </cpp:mapping>
        <cpp:mapping>
            <cpp:frameworkName>Nestor Seal</cpp:frameworkName>
            <cpp:correspondingTerm>
                <p>Integrity</p>
            </cpp:correspondingTerm>
            <cpp:correspondingSection>
                <p>C14 Integrity: Ingest Interface</p>
            </cpp:correspondingSection>
        </cpp:mapping>
        <cpp:mapping>
            <cpp:frameworkName>ISO 16363</cpp:frameworkName>
            <cpp:correspondingTerm>
                <p>integrity measurements</p>
            </cpp:correspondingTerm>
            <cpp:correspondingSection>
                <p>Checksum Generation: 3.3.5 The repository shall define, collect, track, and
                    appropriately provide its information integrity measurements.</p>
                <p>Recording: 4.1.6 The repository shall obtain sufficient control over the
                    Digital Objects to preserve them.</p>
            </cpp:correspondingSection>
        </cpp:mapping>
        <cpp:mapping>
            <cpp:frameworkName>OAIS</cpp:frameworkName>
            <cpp:correspondingSection>
                <p>OAIS does not describe the process of checksum generation and recording in
                    its functional model but defines fixity information as part of Administrative
                    metadata, which is “necessary for adequate preservation of the Content Data
                    Object”.</p>
            </cpp:correspondingSection>
        </cpp:mapping>
        <cpp:mapping>
            <cpp:frameworkName>PREMIS</cpp:frameworkName>
            <cpp:correspondingTerm>
                <p>Message digest calculation</p>
            </cpp:correspondingTerm>
            <cpp:correspondingSection>
                <p>The term “message digest calculation” is referenced in the glossary.</p>
                <p>The general topic of fixity is addressed in section Fixity, Integrity,
                    Authenticity, p. 258.</p>
            </cpp:correspondingSection>
        </cpp:mapping>
    </cpp:frameworkMappings>
    <cpp:referenceImplementations>
        <cpp:publicDocumentation>
            <cpp:institution>
                <cpp:institutionLabel>TIB – Leibniz Information Centre for Science and Technology and University Library</cpp:institutionLabel>
                <cpp:institutionCountry>DE</cpp:institutionCountry>
                <cpp:institutionType>National library</cpp:institutionType>
                <cpp:institutionType>Non-commercial digital preservation service</cpp:institutionType>
                <cpp:institutionType>Research infrastructure</cpp:institutionType>
                <cpp:institutionType>Research performing organisation</cpp:institutionType>
            </cpp:institution>
            <cpp:linkToDocumentation xml:lang="en">
                <cpp:hyperlink>
                    //wiki.tib.eu/confluence/spaces/lza/pages/93608951/Metadata#Metadata-TMDTechnicalmetadata</cpp:hyperlink>
            </cpp:linkToDocumentation>
        </cpp:publicDocumentation>
        <cpp:publicDocumentation>
            <cpp:institution>
                <cpp:institutionLabel>CSC – IT Center for Science Ltd.</cpp:institutionLabel>
                <cpp:institutionCountry>FI</cpp:institutionCountry>
                <cpp:institutionType>Non-commercial digital preservation service</cpp:institutionType>
            </cpp:institution>
            <cpp:linkToDocumentation xml:lang="en">
                <cpp:hyperlink>
                    https://wiki.tib.eu/confluence/spaces/lza/pages/93608951/Metadata#Metadata-TMDTechnicalmetadata</cpp:hyperlink>
                <cpp:comment>section 2.4.4.2</cpp:comment>
            </cpp:linkToDocumentation>
        </cpp:publicDocumentation>
        <cpp:publicDocumentation>
            <cpp:institution>
                <cpp:institutionLabel>Archivematica</cpp:institutionLabel>
                <cpp:institutionCountry>CA</cpp:institutionCountry>
                <cpp:institutionType>Digital preservation system</cpp:institutionType>
            </cpp:institution>
            <cpp:linkToDocumentation xml:lang="en">
                <cpp:hyperlink>
                    https://www.archivematica.org/en/docs/archivematica-1.17/user-manual/transfer/transfer/#transfer-tab-microservices</cpp:hyperlink>
            </cpp:linkToDocumentation>
        </cpp:publicDocumentation>
    </cpp:referenceImplementations>
</cpp:cpp>
